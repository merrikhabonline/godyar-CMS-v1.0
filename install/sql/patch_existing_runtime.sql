ALTER TABLE users ADD COLUMN twofa_enabled BOOLEAN NOT NULL DEFAULT 0; ALTER TABLE users ADD COLUMN twofa_secret VARCHAR(255) NULL; ALTER TABLE users ADD COLUMN session_version INT NOT NULL DEFAULT 1; ALTER TABLE news ADD COLUMN views INT NOT NULL DEFAULT 0; CREATE TABLE IF NOT EXISTS visits ( id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT, PRIMARY KEY (id), page VARCHAR(60) NOT NULL, news_id INT NULL, source VARCHAR(20) NOT NULL DEFAULT 'direct', referrer VARCHAR(255) NULL, user_ip VARCHAR(45) NULL, user_agent VARCHAR(255) NULL, os VARCHAR(40) NULL, browser VARCHAR(40) NULL, device VARCHAR(20) NULL, created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, KEY idx_created (created_at), KEY idx_news (news_id), KEY idx_source (source) ); ALTER TABLE visits ADD COLUMN news_id INT NULL; ALTER TABLE visits ADD COLUMN source VARCHAR(20) NOT NULL DEFAULT 'direct'; ALTER TABLE visits ADD COLUMN referrer VARCHAR(255) NULL; ALTER TABLE visits ADD COLUMN user_ip VARCHAR(45) NULL; ALTER TABLE visits ADD COLUMN user_agent VARCHAR(255) NULL; ALTER TABLE visits ADD COLUMN os VARCHAR(40) NULL; ALTER TABLE visits ADD COLUMN browser VARCHAR(40) NULL; ALTER TABLE visits ADD COLUMN device VARCHAR(20) NULL; ALTER TABLE visits ADD COLUMN created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP; CREATE TABLE IF NOT EXISTS opinion_authors ( id SERIAL PRIMARY KEY, name VARCHAR(255) NOT NULL, slug VARCHAR(255) NOT NULL UNIQUE, page_title VARCHAR(255) NULL, bio TEXT NULL, specialization VARCHAR(255) NULL, social_website VARCHAR(255) NULL, social_twitter VARCHAR(255) NULL, social_facebook VARCHAR(255) NULL, email VARCHAR(190) NULL, avatar VARCHAR(255) NULL, is_active BOOLEAN NOT NULL DEFAULT 1, sort_order INT NOT NULL DEFAULT 0, display_order INT NOT NULL DEFAULT 0, articles_count INT NOT NULL DEFAULT 0, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP ); CREATE TABLE IF NOT EXISTS elections ( id SERIAL PRIMARY KEY, title VARCHAR(255) NOT NULL, slug VARCHAR(255) NOT NULL UNIQUE, description TEXT NULL, is_active BOOLEAN NOT NULL DEFAULT 1, starts_at DATETIME NULL, ends_at DATETIME NULL, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP ); CREATE TABLE IF NOT EXISTS election_regions ( id SERIAL PRIMARY KEY, election_id INT NULL, name VARCHAR(255) NOT NULL, slug VARCHAR(255) NULL, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, KEY idx_election_id (election_id) ); CREATE TABLE IF NOT EXISTS election_parties ( id SERIAL PRIMARY KEY, election_id INT NULL, name VARCHAR(255) NOT NULL, slug VARCHAR(255) NULL, color VARCHAR(32) NULL, logo VARCHAR(255) NULL, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, KEY idx_election_id (election_id) ); CREATE TABLE IF NOT EXISTS election_constituencies ( id SERIAL PRIMARY KEY, election_id INT NULL, region_id INT NULL, name VARCHAR(255) NOT NULL, slug VARCHAR(255) NULL, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, KEY idx_election_id (election_id), KEY idx_region_id (region_id) ); CREATE TABLE IF NOT EXISTS election_candidates ( id SERIAL PRIMARY KEY, election_id INT NULL, constituency_id INT NULL, party_id INT NULL, name VARCHAR(255) NOT NULL, slug VARCHAR(255) NULL, avatar VARCHAR(255) NULL, votes INT NOT NULL DEFAULT 0, is_winner BOOLEAN NOT NULL DEFAULT 0, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, KEY idx_election_id (election_id), KEY idx_constituency_id (constituency_id), KEY idx_party_id (party_id) ); CREATE TABLE IF NOT EXISTS election_results_summary ( id SERIAL PRIMARY KEY, election_id INT NULL, party_id INT NULL, seats INT NOT NULL DEFAULT 0, votes INT NOT NULL DEFAULT 0, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, KEY idx_election_id (election_id), KEY idx_party_id (party_id) ); CREATE TABLE IF NOT EXISTS election_results_regions ( id SERIAL PRIMARY KEY, election_id INT NULL, region_id INT NULL, party_id INT NULL, seats INT NOT NULL DEFAULT 0, votes INT NOT NULL DEFAULT 0, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, KEY idx_election_id (election_id), KEY idx_region_id (region_id), KEY idx_party_id (party_id) );
