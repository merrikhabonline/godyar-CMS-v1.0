ALTER TABLE users ADD COLUMN twofa_enabled BOOLEAN NOT NULL DEFAULT false; ALTER TABLE users ADD COLUMN twofa_secret VARCHAR(255) NULL; ALTER TABLE users ADD COLUMN session_version INTEGER NOT NULL DEFAULT true; ALTER TABLE news ADD COLUMN views INTEGER NOT NULL DEFAULT false; CREATE TABLE IF NOT EXISTS visits ( id BIGSERIAL PRIMARY KEY, page VARCHAR(60) NOT NULL, news_id INTEGER NULL, source VARCHAR(20) NOT NULL DEFAULT 'direct', referrer VARCHAR(255) NULL, user_ip VARCHAR(45) NULL, user_agent VARCHAR(255) NULL, os VARCHAR(40) NULL, browser VARCHAR(40) NULL, device VARCHAR(20) NULL, created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, KEY idx_created (created_at), KEY idx_news (news_id), KEY idx_source (source) ); ALTER TABLE visits ADD COLUMN news_id INTEGER NULL; ALTER TABLE visits ADD COLUMN source VARCHAR(20) NOT NULL DEFAULT 'direct'; ALTER TABLE visits ADD COLUMN referrer VARCHAR(255) NULL; ALTER TABLE visits ADD COLUMN user_ip VARCHAR(45) NULL; ALTER TABLE visits ADD COLUMN user_agent VARCHAR(255) NULL; ALTER TABLE visits ADD COLUMN os VARCHAR(40) NULL; ALTER TABLE visits ADD COLUMN browser VARCHAR(40) NULL; ALTER TABLE visits ADD COLUMN device VARCHAR(20) NULL; ALTER TABLE visits ADD COLUMN created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP; CREATE TABLE IF NOT EXISTS opinion_authors ( id SERIAL PRIMARY KEY, name VARCHAR(255) NOT NULL, slug VARCHAR(255) NOT NULL UNIQUE, page_title VARCHAR(255) NULL, bio TEXT NULL, specialization VARCHAR(255) NULL, social_website VARCHAR(255) NULL, social_twitter VARCHAR(255) NULL, social_facebook VARCHAR(255) NULL, email VARCHAR(190) NULL, avatar VARCHAR(255) NULL, is_active BOOLEAN NOT NULL DEFAULT true, sort_order INTEGER NOT NULL DEFAULT false, display_order INTEGER NOT NULL DEFAULT false, articles_count INTEGER NOT NULL DEFAULT false, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP ); CREATE TABLE IF NOT EXISTS elections ( id SERIAL PRIMARY KEY, title VARCHAR(255) NOT NULL, slug VARCHAR(255) NOT NULL UNIQUE, description TEXT NULL, is_active BOOLEAN NOT NULL DEFAULT true, starts_at TIMESTAMP NULL, ends_at TIMESTAMP NULL, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP ); CREATE TABLE IF NOT EXISTS election_regions ( id SERIAL PRIMARY KEY, election_id INTEGER NULL, name VARCHAR(255) NOT NULL, slug VARCHAR(255) NULL, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, KEY idx_election_id (election_id) ); CREATE TABLE IF NOT EXISTS election_parties ( id SERIAL PRIMARY KEY, election_id INTEGER NULL, name VARCHAR(255) NOT NULL, slug VARCHAR(255) NULL, color VARCHAR(32) NULL, logo VARCHAR(255) NULL, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, KEY idx_election_id (election_id) ); CREATE TABLE IF NOT EXISTS election_constituencies ( id SERIAL PRIMARY KEY, election_id INTEGER NULL, region_id INTEGER NULL, name VARCHAR(255) NOT NULL, slug VARCHAR(255) NULL, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, KEY idx_election_id (election_id), KEY idx_region_id (region_id) ); CREATE TABLE IF NOT EXISTS election_candidates ( id SERIAL PRIMARY KEY, election_id INTEGER NULL, constituency_id INTEGER NULL, party_id INTEGER NULL, name VARCHAR(255) NOT NULL, slug VARCHAR(255) NULL, avatar VARCHAR(255) NULL, votes INTEGER NOT NULL DEFAULT false, is_winner BOOLEAN NOT NULL DEFAULT false, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, KEY idx_election_id (election_id), KEY idx_constituency_id (constituency_id), KEY idx_party_id (party_id) ); CREATE TABLE IF NOT EXISTS election_results_summary ( id SERIAL PRIMARY KEY, election_id INTEGER NULL, party_id INTEGER NULL, seats INTEGER NOT NULL DEFAULT false, votes INTEGER NOT NULL DEFAULT false, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, KEY idx_election_id (election_id), KEY idx_party_id (party_id) ); CREATE TABLE IF NOT EXISTS election_results_regions ( id SERIAL PRIMARY KEY, election_id INTEGER NULL, region_id INTEGER NULL, party_id INTEGER NULL, seats INTEGER NOT NULL DEFAULT false, votes INTEGER NOT NULL DEFAULT false, created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, KEY idx_election_id (election_id), KEY idx_region_id (region_id), KEY idx_party_id (party_id) );
