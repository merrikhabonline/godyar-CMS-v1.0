CREATE TABLE IF NOT EXISTS visits ( id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, page VARCHAR(500) NOT NULL, ip_address VARCHAR(45) NOT NULL, user_agent VARCHAR(500) NULL, referrer VARCHAR(500) NULL, visit_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, KEY idx_visits_time (visit_time), KEY idx_visits_page (page(191)) ); CREATE TABLE IF NOT EXISTS sessions ( id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, session_id VARCHAR(191) NOT NULL, user_id INTEGER NULL, ip_address VARCHAR(45) NULL, user_agent VARCHAR(500) NULL, data TEXT NULL, last_activity TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, UNIQUE KEY uq_sessions_session_id (session_id), KEY idx_sessions_last_activity (last_activity), KEY idx_sessions_user_id (user_id) ); CREATE TABLE IF NOT EXISTS feeds ( id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, name VARCHAR(255) NOT NULL, url VARCHAR(500) NOT NULL, category_id INTEGER NULL, is_active BOOLEAN NOT NULL DEFAULT true, fetch_interval_minutes INTEGER NOT NULL DEFAULT 60, last_fetched_at TIMESTAMP NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, UNIQUE KEY uq_feeds_url (url(191)), KEY idx_feeds_category_id (category_id), KEY idx_feeds_is_active (is_active) ); ALTER TABLE news ADD COLUMN excerpt VARCHAR(500) NULL, ADD COLUMN views INTEGER NOT NULL DEFAULT false, ADD COLUMN is_featured BOOLEAN NOT NULL DEFAULT false, ADD COLUMN priority SMALLINT NOT NULL DEFAULT false, ADD COLUMN seo_title VARCHAR(255) NULL, ADD COLUMN seo_description VARCHAR(300) NULL, ADD COLUMN seo_keywords VARCHAR(500) NULL; CREATE INDEX idx_news_status_publish ON news (status, publish_at); CREATE INDEX idx_news_category ON news (category_id); CREATE INDEX idx_news_tags_news ON news_tags (news_id); CREATE INDEX idx_news_tags_tag ON news_tags (tag_id); ALTER TABLE settings ALTER COLUMN value TYPE TEXT;
